# Telegram 机器人部署说明

## ⚠️ 重要提示：24/7运行机器人

**网页版限制：** 当前网页版机器人依赖浏览器轮询，**关闭网页后将无法接收和转发消息**。这是浏览器的技术限制。

**解决方案：** 要实现24/7运行（关闭网页后仍能工作），**必须**使用以下方法：

### 方法一：使用Google Apps Script (推荐)

项目中已包含 `google-apps-script/TelegramBot.gs` 文件，可以在Google云端独立运行。

**部署步骤：**

1. 访问 [Google Apps Script](https://script.google.com/)
2. 创建新项目
3. 复制 `google-apps-script/TelegramBot.gs` 的内容到编辑器
4. 在代码顶部的 `CONFIG` 对象中填入你的配置：
   ```javascript
   const CONFIG = {
     BOT_TOKEN: "你的机器人令牌",
     PERSONAL_USER_ID: "你的个人用户ID",
     GREETING_MESSAGE: "你的问候消息",
     // ... 其他配置
   };
   ```
5. 点击"部署" -> "新建部署"
6. 类型选择"Web应用"
7. "执行身份"选择"我"
8. "谁有权访问"选择"任何人"
9. 点击"部署"并复制Web应用URL
10. 运行代码中的 `setWebhook()` 函数，将URL设置为Telegram Webhook

**优势：**
- 完全免费
- 24/7运行
- 自动处理消息
- 数据存储在Google Sheets

### 方法二：使用本项目的网页版

网页版适合：
- 测试和开发
- 临时使用
- 需要可视化界面管理

**注意：** 网页版需要保持浏览器标签页打开才能接收消息。

## 问题2：提示音测试

已在配置对话框添加"测试"按钮，可以直接测试提示音效果。如果没有声音：
1. 检查浏览器是否允许网站播放声音
2. 检查系统音量设置
3. 点击"测试"按钮（需要用户交互后才能播放声音）

## 问题3：回复逻辑改进

已优化APP回复机制：

**在Telegram APP中回复消息：**
1. 收到转发消息时，消息格式已包含chatId信息
2. 使用命令回复特定聊天：`/reply <chatId> <消息内容>`
3. 直接回复最后一条消息：`/r <消息内容>` 或直接发送消息

**重要改进：**
- APP中发送的消息不再显示在网页控制台
- 转发消息中明确标注chatId，避免回复错人
- 每次回复都会准确更新目标chatId

## 问题4：授权管理后台

访问 `/admin` 路径可进入管理后台。

**登录信息：**
- 用户名：`admin`
- 密码：`qqai18301`

**功能：**
- ✅ 添加多个机器人令牌
- ✅ 为每个令牌设置独立配置（个人ID、问候消息）
- ✅ 设置使用期限，到期自动停止
- ✅ 启动/停止激活
- ✅ 延长使用日期
- ✅ 删除激活
- ✅ 数据存储在浏览器localStorage（无需数据库）

**注意：** 管理后台数据存储在浏览器本地，清除浏览器数据会丢失配置。

## 推荐部署方案

**最佳实践：**
1. 使用Google Apps Script部署机器人核心功能（24/7运行）
2. 使用网页版控制台进行管理和监控
3. 使用管理后台(`/admin`)管理多个机器人激活

这样可以获得最佳的稳定性和管理便利性。
